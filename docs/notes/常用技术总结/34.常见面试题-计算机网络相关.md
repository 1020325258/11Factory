## 1.OSI 七层模型？

OSI 七层模型：应用层、表示层、会话层、传输层、网络层、数据链路层、物理层

TCP/IP 五层模型：应用层、传输层、网络层、链路层、物理层



**应用层**

应用层是由网络应用程序使用的，是离用户最近的一层

应用层通过各种协议，为网络应用提供服务，常见协议如下：

- FTP - 文件传输协议
- HTTP/S - 超文本传输（安全）协议
- SMTP - 邮件发送协议：用于与邮件服务器建立通信，并处理电子邮件的发送操作
- POP3 - 邮件接收协议：用于与邮件服务器建立通信，并且从服务器中检索邮件
- Telnet ： 与虚拟段之间的通信协议



**表示层**

表示层从应用层接收数据，这些数据以字符和数字的形式出现，表示层将这些`字符和数据`转成`二进制`

在传输数据之前，表示层将原始数据进行压缩，可以加快传输，并且保证完整性数据传输前的数据加密

在发送端，数据在表示层会被加密，在接收端，数据在表示层会进行解密操作



**会话层**

会话层用于建立连接、管理连接、发送和接收数据

在客户端和服务器建立会话之前，服务端会对客户端进行身份验证并且授权



**传输层**

传输层通过分段、流量控制、差错控制来控制通信的可靠性



**网络层**

网络层将从传输层接收到的数据段从一台计算机传输到不同网络的另一台计算机中

网络层的数据单元成为数据包

网络层的功能是：逻辑寻址、路由、路径确定



**数据链路层**

数据链路层从网络层接收数据包，数据包包含了发送方和接收方的 IP 地址

逻辑寻址在网络层已经完成，即添加了 IP 地址，形成 IP 数据包

物理寻址在数据链路层中完成，在 IP 数据包中添加发送方和接收方计算机的物理地址，从而形成一个数据帧

MAC 地址是由计算机制造商嵌入到计算机中的，是唯一的



**物理层**

物理层将二进制序列转成信号在本地戒指（铜缆、光纤、无线信号）上传输 





## 2.发送邮件属于哪一层，基于什么协议？

利用 E-mail 收发电子邮件，需要设置 POP3 服务器和 SMTP 服务器的地址

用户要从邮件服务提供商提供的电子邮箱中获取自己的电子邮件，就需要通过邮件服务提供商的POP3邮件服务器来帮助完成。

发送邮件即 SMTP（Simple Mail Transfer Protocol）协议，属于应用层，SMTP、POP3 都是基于 `TCP/IP` 的应用层协议



## 3.各层协议了解吗？

网络层协议：

- IP 协议
- ICMP 协议
- ARP 协议 
- RARP 协议



传输层协议：

- TCP 协议
- UDP 协议



应用层协议：

- FTP
- Telnet
- SMTP
- HTTP
- RIP
- NFS
- DNS
- RSTP



## 4.TCP 和 UDP 的区别？

当网络出现拥塞时，TCP 能够减少向网络诸如数据的速率和数量，缓解拥塞

UDP 没有拥塞控制，会导致在网络不好的情况下会丢包，但是如果在实时性要求较高的场景下，就需要使用 UDP 而不是 HTTP



TCP：

- 面向连接
- 可靠传输，可以流量控制和拥塞控制
- 一对一
- 面向字节流

UDP：

- 无连接
- 不可靠传输
- 支持 一对一、一对多、多对一、多对多
- 面向报文





## 5.流量控制是什么？

流量控制：让发送方根据接收方的实际接收能力，来控制发送的数据量

接收方每次收到数据包时，在发送确认报文的时候，告诉发送方自己的缓冲区还有多少时空闲的，那么当发送方收到之后，就会调整自己的发送窗口的大小

那么当接收方缓存满了之后，发送方该什么时候去继续发送数据呢？

可以让接收方处理完数据之后，发送通知给发送方，表示可以继续接收数据

但是如果这个通知存在丢失的风险，因此我们也可以让发送方启动一个定时器，每隔一段时间就去询问接收方，是否可以继续发送数据



**接收窗口大小固定吗？**

在现在的 TCP 中，接收窗口的大小是会动态调整的

一般情况下，接收窗口 >= 发送窗口



## 6.TCP 的四种拥塞控制算法

名词解释：

cwnd = 拥塞窗口

swnd = 发送窗口

rwnd = 接收窗口

ssthresh：慢启动门限

1. 慢开始

连接建立完成后，初始 cwnd = 1，表示发送方可以传输 1 个报文段

当发送方接收到 1 个 ACK 应答后，表示接收方已经成功接收报文，于是发送方 cwnd += 1，表示发送方可以传输 2 个报文段

当发送方接收到 2 个 ACK 应答后， cwnd += 2，表示发送方可以传输 4 个报文段

当发送方接收到 4 个 ACK 应答后， cwnd += 4，表示发送方可以传输 8 个报文段

在慢开始中，发送方可以发送的包的数量是`指数级的增长`

1. 拥塞避免

当 cwnd >= ssthresh 时，就会使用拥塞避免算法，一般来说 `ssthresh = 65535字节`

此时，接收方每接收到一个 ACK 时，cwnd 就会增加 1/cwnd

即，假设 `ssthresh=8`，那么当接收方收到 8 个 ACK 时，每次确认增加 1/8 个 cwnd，当 8 个 ACK 全部收到之后，一共可以增加 1 个 cwnd，于是下一次接受方可以发送 9 个数据包

在拥塞避免中，发送方可以发送的包的数量是`线性增长`

1. 拥塞发生

当发送方可以发送包的数量一直增长，网络就会慢慢进入拥塞的状态，于是会出现丢包现象，那么此时发送方就需要对丢失的数据包进行重传

当触发了重传机制，就会使用拥塞发生算法

重传机制分为两种：

- 超时重传
- 快速重传

当发生超时重传时，此时会更新 `ssthresh` 和 `cwnd` 的值： `ssthresh=cwnd/2，cwnd=1（cwnd恢复为初始化的值） `

这种情况下，会导致拥塞窗口一下子变为初始值，发送方发送数据速率突然下降很多，那么又会从慢开始再进入到拥塞避免阶段，这期间发送速率太慢，会导致网络卡顿

当发生快重传时，即接收方发现丢了一个中间包的时候，发送 3 个前一个包的 ACK ，那么就触发了快速重传，不需要等待超时再重传

此时更新 `ssthresh` 和 `cwnd` 的值：`cwnd = cwnd / 2，ssthresh = cwnd`，会进入到快速恢复算法

1. 快速恢复

快速恢复和快速重传一般会同时使用，在快速恢复算法中，先让 `cwnd = ssthresh + 3`，之后发送端重传丢失的数据包，如果再收到重复的 ACK，令 cwnd += 1，如果收到新数据的 ACK 后，令 cwnd = ssthresh





**为什么收到重复的 ACK，cwnd 反而增加呢？** 

收到重复的 ACK 表明发送端发送的数据包接收端还没有收到，因此让 cwnd + 1 ，有快速重传机制的存在，那么客户端如果一直触发 `快速重传` 那么就一直增加 cwnd，从而将丢失的数据包尽快发送给接收端

参考：[小林 TCP 讲解](https://www.xiaolincoding.com/network/3_tcp/tcp_feature.html#%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D)





## 7.有了流量控制，为什么还需要拥塞控制？

流量控制的目的是控制发送方速率，避免接收端没有缓存接收数据

但是，计算机网络是一个共享的环境，那么传输的数据包丢失可能不仅仅是因为接收方没有缓存，而是网络不稳定或者网络因为其他主机之间的通信而变得拥堵

那么此时，就不能只根据接收方的缓存来控制发送方的发送速率了，因此需要拥塞控制

**拥塞控制就是避免发送方的数据填满整个网络**



